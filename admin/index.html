<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AfriChamps Admin Dashboard</title>
  <style>
    :root{
      --bg:#0b0d10;
      --panel:#0f1217;
      --panel2:#111823;
      --border:rgba(255,255,255,.08);
      --text:#e8edf5;
      --muted:#94a3b8;
      --gold:#d4af37;
      --gold2:#b88a1e;
      --danger:#ff4d4d;
      --ok:#2dd4bf;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica;
      background: radial-gradient(1200px 800px at 10% 10%, rgba(212,175,55,.10), transparent 60%),
                  radial-gradient(900px 600px at 90% 20%, rgba(45,212,191,.08), transparent 55%),
                  var(--bg);
      color:var(--text);
    }

    .wrap{ max-width:1100px; margin:36px auto; padding:0 16px; }

    .topbar{
      display:flex; gap:16px; align-items:center; justify-content:space-between;
      padding:18px 18px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(212,175,55,.08), rgba(255,255,255,.02));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .brand{
      display:flex; gap:12px; align-items:center;
    }
    .badge{
      width:42px; height:42px; border-radius:12px;
      background: linear-gradient(135deg, rgba(212,175,55,.35), rgba(184,138,30,.08));
      border:1px solid rgba(212,175,55,.35);
      display:grid; place-items:center;
      font-weight:800; color:var(--gold);
      letter-spacing:.5px;
    }
    h1{ font-size:18px; margin:0; }
    .sub{ font-size:12px; color:var(--muted); margin-top:2px; }

    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:16px;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }
    .card h2{
      font-size:14px;
      margin:0 0 10px 0;
      color:var(--gold);
      letter-spacing:.3px;
      text-transform:uppercase;
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    label{
      font-size:12px;
      color:var(--muted);
      display:block;
      margin:6px 0 6px;
    }

    input, select{
      background: rgba(17,24,35,.85);
      color: var(--text);
      border:1px solid var(--border);
      border-radius: 12px;
      padding: 11px 12px;
      outline:none;
      min-width: 180px;
    }
    input::placeholder{ color: rgba(148,163,184,.65); }

    input:focus, select:focus{
      border-color: rgba(212,175,55,.55);
      box-shadow: 0 0 0 3px rgba(212,175,55,.12);
    }

    .btn{
      border:1px solid rgba(212,175,55,.35);
      background: linear-gradient(180deg, rgba(212,175,55,.25), rgba(184,138,30,.10));
      color: var(--text);
      border-radius: 12px;
      padding: 11px 14px;
      font-weight: 700;
      cursor:pointer;
    }
    .btn:hover{ filter: brightness(1.06); }
    .btn:active{ transform: translateY(1px); }

    .btn-danger{
      border:1px solid rgba(255,77,77,.35);
      background: linear-gradient(180deg, rgba(255,77,77,.18), rgba(255,77,77,.08));
    }

    .status{
      margin-top:10px;
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid var(--border);
      background: rgba(15,18,23,.65);
      font-size: 13px;
      color: var(--muted);
    }
    .status.ok{ color: var(--ok); border-color: rgba(45,212,191,.25); }
    .status.bad{ color: var(--danger); border-color: rgba(255,77,77,.25); }

    table{
      width:100%;
      border-collapse: collapse;
      margin-top:12px;
      overflow:hidden;
      border-radius: 14px;
      border:1px solid var(--border);
      background: rgba(17,24,35,.55);
    }
    th, td{
      padding: 12px 10px;
      text-align:left;
      border-bottom:1px solid rgba(255,255,255,.06);
      font-size: 13px;
    }
    th{
      color: rgba(232,237,245,.85);
      font-weight: 800;
      background: rgba(212,175,55,.08);
    }
    td{ color: rgba(232,237,245,.90); }
    tr:last-child td{ border-bottom:none; }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid rgba(212,175,55,.25);
      background: rgba(212,175,55,.08);
      color: var(--gold);
      font-weight: 800;
      letter-spacing:.3px;
      font-size: 12px;
    }

    .muted{ color: var(--muted); font-size:12px; }
    .grow{ flex: 1; min-width: 260px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="badge">VIP</div>
        <div>
          <h1>Client Tier Admin Dashboard</h1>
          <div class="sub">Manage MT5 logins for Affiliate / VIP / Master / Elite</div>
        </div>
      </div>
      <div class="pill">AfriChamps South Africa</div>
    </div>

    <div class="grid">
      <!-- Settings -->
      <div class="card">
        <h2>Connection</h2>

        <label>API Base URL</label>
        <div class="row">
          <input id="apiBase" class="grow" placeholder="https://your-app.onrender.com" />
        </div>

        <label>Admin Secret</label>
        <div class="row">
          <input id="secret" class="grow" placeholder="Your ADMIN_SECRET" />
          <button class="btn" onclick="saveSettings()">Save</button>
          <button class="btn" onclick="ping()">Ping</button>
        </div>

        <div id="status" class="status">Set your API Base URL + Admin Secret.</div>
        <div class="muted" style="margin-top:10px;">
          Tip: if changes don’t show, hard refresh (Ctrl+Shift+R).
        </div>
      </div>

      <!-- Add -->
      <div class="card">
        <h2>Add or Update Client</h2>

        <label>MT5 Login</label>
        <input id="login" class="grow" placeholder="e.g. 12345678" />

        <label>Tier</label>
        <!-- ✅ THIS IS THE TIER DROPDOWN -->
        <select id="tier" class="grow">
          <option value="AFFILIATE">Affiliate</option>
          <option value="VIP" selected>VIP</option>
          <option value="MASTER">Master</option>
          <option value="ELITE">Elite</option>
        </select>

        <label>Note (optional)</label>
        <input id="note" class="grow" placeholder="Client name / expiry note / broker etc." />

        <div class="row" style="margin-top:10px;">
          <button class="btn" onclick="addVip()">Save Client</button>
          <button class="btn" onclick="loadList()">Refresh List</button>
        </div>
      </div>

      <!-- Remove -->
      <div class="card">
        <h2>Remove Client</h2>

        <label>MT5 Login to remove</label>
        <div class="row">
          <input id="removeLogin" class="grow" placeholder="e.g. 12345678" />
          <button class="btn btn-danger" onclick="removeVip()">Remove</button>
        </div>

        <div class="muted" style="margin-top:10px;">
          Removing deletes the login from the database completely.
        </div>
      </div>

      <!-- List -->
      <div class="card">
        <h2>Client List</h2>

        <div class="row">
          <select id="listTier">
            <option value="">All tiers</option>
            <option value="AFFILIATE">Affiliate</option>
            <option value="VIP">VIP</option>
            <option value="MASTER">Master</option>
            <option value="ELITE">Elite</option>
          </select>
          <button class="btn" onclick="loadList()">Apply Filter</button>
        </div>

        <table>
          <thead>
            <tr>
              <th>Login</th>
              <th>Tier</th>
              <th>Note</th>
              <th>Created</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
    </div>
  </div>

<script>
  function $(id){ return document.getElementById(id); }

  function setStatus(msg, ok){
    const el = $("status");
    el.textContent = msg;
    el.className = "status " + (ok ? "ok" : "bad");
  }

  function saveSettings(){
    localStorage.setItem("vip_apiBase", $("apiBase").value.trim());
    localStorage.setItem("vip_secret", $("secret").value.trim());
    setStatus("Saved ✅", true);
  }

  function loadSettings(){
    $("apiBase").value = localStorage.getItem("vip_apiBase") || "";
    $("secret").value = localStorage.getItem("vip_secret") || "";
  }

  async function ping(){
    const base = $("apiBase").value.trim();
    if(!base) return setStatus("Enter API Base URL first.", false);

    try{
      const r = await fetch(`${base}/`);
      const t = await r.text();
      if(r.ok) setStatus("API OK ✅ " + t, true);
      else setStatus("API error: " + t, false);
    }catch(e){
      setStatus("Cannot reach API. Check URL and Render status.", false);
    }
  }

  async function loadList(){
    const base = $("apiBase").value.trim();
    const secret = $("secret").value.trim();
    const tier = $("listTier").value.trim();

    if(!base || !secret) return setStatus("Set API Base + Admin Secret first.", false);

    const url = tier ? `${base}/api/admin/list?tier=${encodeURIComponent(tier)}` : `${base}/api/admin/list`;

    const r = await fetch(url, { headers: { "x-admin-secret": secret } });
    const j = await r.json();
    if(!j.ok) return setStatus(j.error || "Failed to load list", false);

    const tbody = $("rows");
    tbody.innerHTML = "";
    j.rows.forEach(x => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${x.login}</td>
        <td><span class="pill">${(x.tier||"").toUpperCase()}</span></td>
        <td>${x.note||""}</td>
        <td>${x.created_at||""}</td>`;
      tbody.appendChild(tr);
    });

    setStatus(`Loaded ${j.rows.length} client(s) ✅`, true);
  }

  async function addVip(){
    const base = $("apiBase").value.trim();
    const secret = $("secret").value.trim();
    const login = $("login").value.trim();
    const tier = $("tier").value.trim();
    const note = $("note").value.trim();

    if(!base || !secret) return setStatus("Set API Base + Admin Secret first.", false);
    if(!login) return setStatus("Enter a login.", false);

    const r = await fetch(`${base}/api/admin/add`, {
      method: "POST",
      headers: { "Content-Type": "application/json", "x-admin-secret": secret },
      body: JSON.stringify({ login, tier, note })
    });
    const j = await r.json();
    if(!j.ok) return setStatus(j.error || "Save failed", false);

    $("login").value = "";
    $("note").value = "";
    setStatus(`Saved ${j.added} as ${j.tier} ✅`, true);
    loadList();
  }

  async function removeVip(){
    const base = $("apiBase").value.trim();
    const secret = $("secret").value.trim();
    const login = $("removeLogin").value.trim();

    if(!base || !secret) return setStatus("Set API Base + Admin Secret first.", false);
    if(!login) return setStatus("Enter a login to remove.", false);

    const r = await fetch(`${base}/api/admin/remove`, {
      method: "POST",
      headers: { "Content-Type": "application/json", "x-admin-secret": secret },
      body: JSON.stringify({ login })
    });
    const j = await r.json();
    if(!j.ok) return setStatus(j.error || "Remove failed", false);

    $("removeLogin").value = "";
    setStatus(`Removed ${j.removed} ✅`, true);
    loadList();
  }

  loadSettings();
</script>
</body>
</html>



